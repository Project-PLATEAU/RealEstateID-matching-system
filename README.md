# 不動産IDマッチングシステム <!-- OSSの対象物の名称を記載ください。分かりやすさを重視し、できるだけ日本語で命名ください。英語名称の場合は日本語説明を（）書きで併記ください。 -->

![概要](./img/ui.png) <!-- OSSの対象物のスクリーンショット（画面表示がない場合にはイメージ画像）を貼り付けください -->

## 1. 概要 <!-- 本リポジトリでOSS化しているソフトウェア・ライブラリについて1文で説明を記載ください -->
本リポジトリでは、Project PLATEAUの令和4年度のユースケース開発業務の一部であるdt23-03「不動産IDマッチングシステム」について、その成果物である「不動産IDマッチングシステム」のソースコードを公開しています。

「不動産IDマッチングシステム」は、不動産登記及び登記所備付地図を活用し、PLATEAUの3D都市モデルの建築物データに、建物の不動産ID、区分所有の不動産ID、土地の不動産IDを付与するシステムです。

## 2. 「不動産IDマッチングシステム」について <!-- 「」内にユースケース名称を記載ください。本文は以下のサンプルを参考に記載ください。URLはアクセンチュアにて設定しますので、サンプルそのままでOKです。 -->
「不動産IDマッチングシステム」は、3D都市モデルを介して不動産IDに紐づけられた様々な建物情報の利活用促進を目指すことを目的として開発しました。
本システムは、不動産登記及び登記所備付地図からマッチング用の「不動産ID空間データ構築環境」とPLATEAUの3D都市モデルの建築物データに不動産IDを付与する「不動産IDマッチングサービス環境」を実装しています。また、不動産IDが付与された3D都市モデルの建築物データをLinked Open Dataに変換し、Linked Open Dataの参照解決を行う「不動産IDマッチングLinked Open Data環境」を実装しています。
本システムは、一般ユーザ向けのGUIを備えたオープンソースソフトウェアとしてフルスクラッチで開発されています。
本システムの詳細については[技術検証レポート](https://www.mlit.go.jp/plateau/file/libraries/doc/plateau_tech_doc_0030_ver01.pdf)を参照してください。

## 3. 利用手順 <!-- 下記の通り、GitHub Pagesへリンクを記載ください。URLはアクセンチュアにて設定しますので、サンプルそのままでOKです。 -->
本システムの構築手順及び利用手順については[利用チュートリアル](https://r5-plateau-acn.github.io/SolarPotential/)を参照してください。

## 4. システム概要 <!-- OSS化対象のシステムが有する機能を記載ください。 -->
### 【不動産ID空間データ構築環境】
#### ①登記所備付地図データ登録機能
- 登記所備付地図（14条地図）データ（GeoJSON形式）を読み込み、筆を示す一意のコードである「筆コード」と筆ポリゴンの代表点を生成します。
- 筆コード、筆の所在地（地番）、代表点及びポリゴンを「筆ポリゴンデータ」テーブルに格納します。

#### ②ジオコーダ用辞書作成機能
- PostGISの「筆ポリゴンデータ」テーブルを読み込み、地番を含む所在地表記をジオコーディングすると結果として筆コードを返すジオコーダ用辞書データを作成します。

#### ③合筆履歴解析機能
- 不動産登記土地データ（CSV）に含まれる変更履歴から合筆情報を抽出し、合筆前の地番が登記所備付地図に収録されていない場合、合筆後の地番の筆コードを返すようにジオコーダ用辞書を拡張します。

#### ④土地不動産ID付与機能　
- 不動産登記土地データ（CSV）から所在地（地番）と対応する不動産番号を取得し、地番に対応する「筆ポリゴンデータ」のレコードに、不動産番号から生成した土地不動産IDを付与します。

#### ⑤建物データ生成機能
- 不動産登記建物データ（CSV）から建物情報を取得し、区分所有建物（以下「区建」）の場合は建物全体が1レコードになるように集約して「建物データ」テーブルに格納します。
- 個別の不動産番号から建物個別の不動産IDを算出し、建物に含まれる不動産IDを管理する「不動産ID対応データ」テーブルに格納します。

#### ⑥建物所在地展開・筆コード付与機能
- 「建物データ」テーブルの各レコードに対して、所在地に含まれる地番リストを展開した「建物所在地データ」テーブルを作成します。
- 各地番にはジオコーディングによって筆コードを付与します。

#### ⑦建物データ属性更新機能
- 建物データ」テーブルの各レコードに対して、床面積の合計・階高・地番リストに含まれる筆ポリゴンを結合した領域を算出して登録します。
- 区建の場合は建物全体の不動産IDを登録します。

### 【不動産IDマッチングサービス環境】
#### ⑧ID・パスワード発行機能
- データ登録を行うためのID・パスワードを発行します。

#### ⑨データ登録機能
- 登録されたデータが、3D都市モデルの建築物データかを確認し、正しければ、リクエストをキューイングします。

#### ⑩建築物マッチング機能
- 3D都市モデル建築物データの接地面図形（LOD0）と建物データを空間演算により重ね合わせ、マッチング結果をPostGIS のテーブルに格納します。

#### ⑪CityGML更新機能
- マッチング結果から3D都市モデルの建築物データに不動産IDを付与し出力します。

### 【不動産IDマッチングLinked Open Data環境】
#### ⑫RDF変換・登録機能
- 不動産IDが付与された3D都市モデル建築物データをRDFに変換し、Firebase Cloud Firestore及び、RDFストアに登録します。

#### ⑬LODの参照解決機能
- HTTPのGETリクエストで指定された形式でLODを返却します。
##### ※「不動産IDマッチングLinked Open Data環境」は「PLATEAU Linked Open Data 配信システム」（https://…………………）において公開しています。

## 5. 利用技術

| 種別              | 名称   | バージョン | 内容 |
| ----------------- | --------|-------------|-----------------------------|
| ミドルウェア      | [poetry](https://python-poetry.org/) | 1.3.2 | Pythonライブラリの管理 |
| ライブラリ        | [GeoAlchemy2](https://geoalchemy-2.readthedocs.io/) | 0.10.2 | SQL データベースを Python で利用するためのライブラリ <br> SQLAlchemyの空間データベース機能拡張（PostGIS にアクセスするために使用） |
|       | [Jageocoder](https://www.info-proto.com/jageocoder/) | 2.0.0 | 住所ジオコーダライブラリ（不動産登記情報における建物所在地を登記所備付地図と突合するために使用） |
|       | [GEOS](https://libgeos.org/) | 3.1.0 | 地理空間情報を処理するためのオープンソースライブラリ（Geometry Engine Open Source） |
|       | [Proj4](https://proj.org/) | 4.5.0 | 空間参照系変換ライブラリ |
|       | [React.js](https://react.dev/) | 18.2.0 | ユーザインターフェース構築のための JavaScript ライブラリ |
| フレームワーク    | [React.js](https://ja.react.dev/) | 18.2.0 | ユーザインターフェース構築のための JavaScript ライブラリ |
| データベース      | [Virtuoso](https://virtuoso.openlinksw.com/) | 7.2.9 | RDF Store（RDFに対してSPARQLでクエリできるデータベース。VirtuosoはGeoSPARQLにも対応している） |

## 6. 動作環境 <!-- 動作環境についての仕様を記載ください。 -->
| 項目               | 最小動作環境                 | 推奨動作環境  | 
| ------------------ | ---------------------------- | ------------- | 
| OS                 | Docker Desktop または Engine | Docker Engine | 
| CPU                | X64 または Apple m1          | X64           | 
| メモリ             | 2GB                          | 8GB           | 
| ディスプレイ解像度 | -                            | -             | 
| ネットワーク       | 1Mbps                        | 10Mbps        | 

## 7. 本リポジトリのフォルダ構成 <!-- 本GitHub上のソースファイルの構成を記載ください。 -->
| フォルダ名 | 詳細                                                      |
|------------|-----------------------------------------------------------|
| dbbuild    | 不動産ID空間データ構築環境 (構築用サンプルファイルを含む) |
| matching   | 不動産IDマッチングサービス環境                            |

## 8. ライセンス <!-- 変更せず、そのまま使うこと。 -->

- ソースコード及び関連ドキュメントの著作権は国土交通省に帰属します。
- 本ドキュメントは[Project PLATEAUのサイトポリシー](https://www.mlit.go.jp/plateau/site-policy/)（CCBY4.0及び政府標準利用規約2.0）に従い提供されています。

## 9. 注意事項 <!-- 変更せず、そのまま使うこと。 -->

- 本リポジトリは参考資料として提供しているものです。動作保証は行っていません。
- 本リポジトリについては予告なく変更又は削除をする可能性があります。
- 本リポジトリの利用により生じた損失及び損害等について、国土交通省はいかなる責任も負わないものとします。

## 10. 参考資料 <!-- 技術検証レポートのURLはアクセンチュアにて記載します。 -->
- 技術検証レポート: https://www.mlit.go.jp/plateau/file/libraries/doc/plateau_tech_doc_0030_ver01.pdf
- PLATEAU WebサイトのUse caseページ「不動産IDマッチングシステム」: https://www.mlit.go.jp/plateau/use-case/uc22-013/
